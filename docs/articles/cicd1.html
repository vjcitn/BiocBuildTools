<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Continuous integration and delivery approaches for Bioconductor • BiocBuildTools</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Continuous integration and delivery approaches for Bioconductor">
<meta property="og:description" content="BiocBuildTools">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-93043521-1"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-93043521-1');
</script>
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">BiocBuildTools</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.17</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/cicd1.html">Continuous integration and delivery approaches for Bioconductor</a>
    </li>
    <li>
      <a href="../articles/gcp.html">Binary package production for GCP/AnVIL</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/vjcitn/BiocBuildTools">
    <span class="fas fa-github"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Continuous integration and delivery approaches for Bioconductor</h1>
                        <h4 class="author">Vincent J. Carey, stvjc at channing.harvard.edu</h4>
            
            <h4 class="date">April 22, 2021</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/vjcitn/BiocBuildTools/blob/master/vignettes/cicd1.Rmd"><code>vignettes/cicd1.Rmd</code></a></small>
      <div class="hidden name"><code>cicd1.Rmd</code></div>

    </div>

    
    
<div id="basic-concepts" class="section level1">
<h1 class="hasAnchor">
<a href="#basic-concepts" class="anchor"></a>Basic concepts</h1>
<div id="release-and-devel-collections" class="section level2">
<h2 class="hasAnchor">
<a href="#release-and-devel-collections" class="anchor"></a>Release and devel collections</h2>
<p>The Bioconductor project has fostered development and use of software for analysis of state-of-the-art genome-scale assays for almost two decades. The project has successfully addressed two conflicting objectives:</p>
<ul>
<li><p>Users require familiar and stable toolsets to perform analyses that may take years to complete.</p></li>
<li><p>Developers want to make use of cutting-edge innovations in biotechnology and computer science to build their tools.</p></li>
</ul>
<p>To achieve these objectives, it was recognized at the outset of the project that package management should emulate the process by which the R language evolves. A “release branch” is defined that constitutes a stable collection. Changes to packages in the release branch are permitted to address bugs or documentation shortfalls; otherwise, code in the release branch is considered permanently locked. Changes to packages in the “devel branch” can introduce new features. A change to a package in the devel branch that alters that package’s API in release must be staged: the “old” API components that are to be removed must remain available for one release in “deprecated” state, after which these components can be declared defunct and removed from functionality.</p>
<p>To accommodate the rapid pace of innovation in biotechnology, release branches of Bioconductor packages are produced every six months, transitioning from the current devel branch. For code from the devel branch to transition into release, formal tests must be passed.</p>
</div>
<div id="implementation-of-release-and-devel-collections-in-git" class="section level2">
<h2 class="hasAnchor">
<a href="#implementation-of-release-and-devel-collections-in-git" class="anchor"></a>Implementation of release and devel collections in git</h2>
<p>The ensemble of R packages managed and distributed in the Bioconductor project is a collection of git repositories. The “devel” version of each package is the “master” branch of the associated repository. The “release” version of each package is a formally tagged branch of the associated repository. The complete history of code changes to each package is preserved in the git log and branch tags of the form <code>RELEASE_X_Y</code> identify the various package releases.</p>
<p>In summary, each git repository for each Bioconductor package contains the history of modifications to source code and documentation, with the master branch providing the current devel image, and <code>RELEASE_X_Y</code> tagged branches providing past releases.</p>
</div>
</div>
<div id="the-current-package-collections" class="section level1">
<h1 class="hasAnchor">
<a href="#the-current-package-collections" class="anchor"></a>The current package collections</h1>
<p>Bioconductor has three main package types: software, annotation, and experiment. ‘Software’ packages primarily support analysis and visualization, ‘annotation’ packages provide reference information about genomes, genes, and other concepts of biology, and ‘experiment’ packages provide curated data and documentation for exemplary experiments.</p>
<p>To obtain the list of package names, we use the git repo git.bioconductor.org/admin/manifest, which has three text files with package names for each of the three types.</p>
</div>
<div id="a-small-collection-for-illustration" class="section level1">
<h1 class="hasAnchor">
<a href="#a-small-collection-for-illustration" class="anchor"></a>A small collection for illustration</h1>
<p>We identified a small group of packages and took a snapshot of the associated repositories.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://vjcitn.github.io/BiocBuildTools/">BiocBuildTools</a></span><span class="op">)</span>
<span class="fu"><a href="../reference/bioc_coreset.html">bioc_coreset</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<pre><code>##  [1] "SummarizedExperiment" "GenomicRanges"        "BiocFileCache"       
##  [4] "Rsamtools"            "rhdf5"                "GEOquery"            
##  [7] "SingleCellExperiment" "ensembldb"            "parody"              
## [10] "DESeq2"               "EDASeq"               "HCAExplorer"         
## [13] "bsseq"</code></pre>
<p>In the following, we unzip the snapshot in a temporary folder.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">td</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html">tempdir</a></span><span class="op">(</span><span class="op">)</span>
<span class="va">curd</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/getwd.html">getwd</a></span><span class="op">(</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/getwd.html">setwd</a></span><span class="op">(</span><span class="va">td</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/files.html">file.copy</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span><span class="op">(</span><span class="st">"demo_srcs"</span>, package<span class="op">=</span><span class="st">"BiocBuildTools"</span><span class="op">)</span>, <span class="va">td</span>, recursive<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/getwd.html">setwd</a></span><span class="op">(</span><span class="va">curd</span><span class="op">)</span> <span class="co"># for knitr</span></code></pre></div>
<div id="self-testing" class="section level2">
<h2 class="hasAnchor">
<a href="#self-testing" class="anchor"></a>Self-testing</h2>
<p>Bioconductor’s guidelines for contributions indicate that contributed packages must pass <code>R CMD check</code>, a constantly evolving procedure for assessing adequacy of package documentation and risks of error in package code.</p>
<p>We’ll use the <em><a href="https://CRAN.R-project.org/package=rcmdcheck">rcmdcheck</a></em> package to capture information on package compliance to basic standards. This runs <code>R CMD check</code> and organizes the message stream from that process.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/getwd.html">setwd</a></span><span class="op">(</span><span class="va">td</span><span class="op">)</span>
<span class="va">chk_parody</span> <span class="op">=</span> <span class="fu">rcmdcheck</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/rcmdcheck/man/rcmdcheck.html">rcmdcheck</a></span><span class="op">(</span><span class="st">"demo_srcs/parody"</span>, quiet<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">chk_parody</span><span class="op">)</span></code></pre></div>
<pre><code>##  [1] "stdout"       "stderr"       "status"       "duration"     "timeout"     
##  [6] "rversion"     "platform"     "errors"       "warnings"     "notes"       
## [11] "description"  "package"      "version"      "cran"         "bioc"        
## [16] "checkdir"     "test_fail"    "install_out"  "session_info" "cleaner"</code></pre>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/getwd.html">setwd</a></span><span class="op">(</span><span class="va">curd</span><span class="op">)</span> <span class="co"># for knitr</span></code></pre></div>
<p>The basic outcomes of a ‘passed’ check process are listed here:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>nerr<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">chk_parody</span><span class="op">$</span><span class="va">errors</span><span class="op">)</span>,nwarn<span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">chk_parody</span><span class="op">$</span><span class="va">warnings</span><span class="op">)</span>,
nnote<span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">chk_parody</span><span class="op">$</span><span class="va">notes</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>##  nerr nwarn nnote 
##     0     0     0</code></pre>
<p>No error was detected, but a warning and several notes were reported. We will look at these in further detail below.</p>
</div>
<div id="implicit-interoperability-testing" class="section level2">
<h2 class="hasAnchor">
<a href="#implicit-interoperability-testing" class="anchor"></a>Implicit interoperability testing</h2>
<p>A goal of the core members of the Bioconductor project is the development of reusable infrastructure components that are employed by independent package contributors. Programming with common data structures and APIs simplifies development of chained workflows, and facilitates methods comparison and optimization. Reusable components can be analyzed for inefficiencies and improved to the benefit of the entire community of users and developers.</p>
<p>R packages declare interdependencies explicitly in the <code>DESCRIPTION</code> file. An example is</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/getwd.html">setwd</a></span><span class="op">(</span><span class="va">td</span><span class="op">)</span>
<span class="va">dcf</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/dcf.html">read.dcf</a></span><span class="op">(</span><span class="st">"demo_srcs/HCAExplorer/DESCRIPTION"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="va">dcf</span><span class="op">[</span>,<span class="st">"Imports"</span><span class="op">]</span><span class="op">)</span></code></pre></div>
<pre><code>## BiocFileCache,
## HCAMatrixBrowser,
## S4Vectors,
## LoomExperiment,
## vctrs,
## curl,
## httr,
## jsonlite,
## methods,
## plyr,
## readr,
## rlang,
## tibble,
## tidygraph,
## utils,
## xml2</code></pre>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"\n"</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/getwd.html">setwd</a></span><span class="op">(</span><span class="va">curd</span><span class="op">)</span></code></pre></div>
<p>The fields <code>Depends</code>, <code>Imports</code>, <code>Suggests</code> and <code>LinkingTo</code> define the independently maintained packages that must be available for <em><a href="https://bioconductor.org/packages/3.13/HCAExplorer">HCAExplorer</a></em> to work effectively. Details on these types of dependency are provided in <a href="https://cran.r-project.org/doc/manuals/r-release/R-exts.html">Writing R Extensions</a>.</p>
<p>We can visualize the interdependencies of a small collection using <em><a href="https://bioconductor.org/packages/3.13/BiocPkgTools">BiocPkgTools</a></em>.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/message.html">suppressMessages</a></span><span class="op">(</span><span class="op">{</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/seandavi/BiocPkgTools">BiocPkgTools</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://vjcitn.github.io/BiocBuildTools/">BiocBuildTools</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org">dplyr</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://magrittr.tidyverse.org">magrittr</a></span><span class="op">)</span>
<span class="op">}</span><span class="op">)</span>
<span class="va">dd</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/BiocPkgTools/man/buildPkgDependencyDataFrame.html">buildPkgDependencyDataFrame</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<pre><code>## 'getOption("repos")' replaces Bioconductor standard repositories, see
## '?repositories' for details
## 
## replacement repositories:
##     CRAN: https://cloud.r-project.org</code></pre>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">dfc</span> <span class="op">=</span> <span class="va">dd</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">Package</span> <span class="op">%in%</span> <span class="fu"><a href="../reference/bioc_coreset.html">bioc_coreset</a></span><span class="op">(</span><span class="op">)</span> <span class="op">&amp;</span> <span class="va">dependency</span> <span class="op">%in%</span> <span class="fu"><a href="../reference/bioc_coreset.html">bioc_coreset</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> 
<span class="va">gg</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/BiocPkgTools/man/buildPkgDependencyIgraph.html">buildPkgDependencyIgraph</a></span><span class="op">(</span><span class="va">dfc</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">gg</span><span class="op">)</span></code></pre></div>
<p><img src="cicd1_files/figure-html/getg-1.png" width="700"></p>
<p>Some of the packages in the small set are isolated.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://generics.r-lib.org/reference/setops.html">setdiff</a></span><span class="op">(</span><span class="fu"><a href="../reference/bioc_coreset.html">bioc_coreset</a></span><span class="op">(</span><span class="op">)</span>, <span class="fu"><a href="https://generics.r-lib.org/reference/setops.html">union</a></span><span class="op">(</span><span class="va">dfc</span><span class="op">$</span><span class="va">Package</span>, <span class="va">dfc</span><span class="op">$</span><span class="va">dependency</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "GEOquery" "parody"</code></pre>
</div>
</div>
<div id="supporting-developers-with-build-system-enhancements" class="section level1">
<h1 class="hasAnchor">
<a href="#supporting-developers-with-build-system-enhancements" class="anchor"></a>Supporting developers with build system enhancements</h1>
<p>The current build system has functioned well as the software collection has grown from a few hundred to more than 1800 packages. The key resources for developers are</p>
<ul>
<li>daily builds and checks of all packages on Linux, Windows and macOS</li>
<li>reports of check process outcomes</li>
<li>simplified distribution of packages and all dependencies via <code><a href="https://rdrr.io/pkg/BiocManager/man/install.html">BiocManager::install</a></code>
</li>
<li>programmatic check for outdated packages via <code><a href="https://rdrr.io/pkg/BiocManager/man/valid.html">BiocManager::valid</a></code>
</li>
</ul>
<p>We propose to enhance these facilities by</p>
<ul>
<li>providing more structure in the check process report to guide developers towards quality improvements</li>
<li>adding information on self-testing and package interdependencies to check process reports</li>
<li>strengthening social coding practice by simplifying pull request production</li>
<li>making the build system platforms continuously available for developer testing</li>
</ul>
<p>The last aim will take considerable work and discussion is deferred.</p>
<div id="improving-check-report-delivery" class="section level2">
<h2 class="hasAnchor">
<a href="#improving-check-report-delivery" class="anchor"></a>Improving check report delivery</h2>
<p>Here is a screen shot of the <code>browse_checks</code> app in BiocBuildTools</p>
<p><img src="geoq.png"></p>
<p>We use pkgnet to generate network statistics and displays related to package and function dependencies.</p>
<p><img src="geoqnet.png"></p>
<p>TO DO:</p>
<ul>
<li>parse URL entry of DESCRIPTION and add ‘start a pull request’ at each relevant part of the report</li>
<li>ingest unit tests and add a tab that provides their source code</li>
<li>develop code coverage reports and convey them – this is probably to be done off line</li>
<li>other social coding support</li>
</ul>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Vincent Carey.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
